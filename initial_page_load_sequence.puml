@startuml
title "Reference: Initial Page Load"

!define USER_COLOR #E3F2FD
!define FRONTEND_COLOR #F3E5F5
!define BACKEND_COLOR #E8F5E9
!define MAP_COLOR #FFF3E0

actor "Student/User" as User
participant "Angular Frontend\n(Discovery Page)" as Frontend
participant "FilterBarComponent" as FilterBar
participant "PropertyListComponent" as PropertyList
participant "MapDisplayComponent" as MapComponent

box "Backend Services"
    participant "PropertyListingController" as Controller
    participant "PropertyService" as Service
    participant "InstituteService" as InstituteService
    participant "Database" as DB
end box

== Initial Page Load ==

User -> Frontend: 1. Navigate to "/discovery" page
activate Frontend

Frontend -> Frontend: 2. Initialize components:\n• FilterBar\n• PropertyList\n• MapDisplay

Frontend -> Controller: 3. GET /api/properties/search (default params)
activate Controller

Controller -> Service: 4. searchProperties(defaultCriteria, pageable)
activate Service

Service -> DB: 5. Query properties with default filters
activate DB
DB --> Service: 6. Page<PropertyListingDTO>
deactivate DB

Service --> Controller: 7. Property results with coordinates
deactivate Service

Controller --> Frontend: 8. 200 OK - Properties data
deactivate Controller

Frontend -> PropertyList: 9. Update property list
activate PropertyList
PropertyList --> User: 10. Display property cards
deactivate PropertyList

Frontend -> MapComponent: 11. Update map with properties
activate MapComponent

note over MapComponent #MAP_COLOR
    **Map Initialization:**
    • Create OpenLayers map
    • Add property pins with coordinates
    • Set default center and zoom
    • Enable clustering for multiple properties
end note

MapComponent --> User: 12. Display map with property pins
deactivate MapComponent

Frontend --> User: 13. Show discovery page with filters, list, and map
deactivate Frontend

@enduml 