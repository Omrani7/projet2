@startuml
title "Reference: Institute Location Selection"

!define USER_COLOR #E3F2FD
!define FRONTEND_COLOR #F3E5F5
!define BACKEND_COLOR #E8F5E9
!define MAP_COLOR #FFF3E0

actor "Student/User" as User
participant "Angular Frontend\n(Discovery Page)" as Frontend
participant "FilterBarComponent" as FilterBar
participant "PropertyListComponent" as PropertyList
participant "MapDisplayComponent" as MapComponent

box "Backend Services"
    participant "PropertyListingController" as Controller
    participant "PropertyService" as Service
    participant "InstituteService" as InstituteService
    participant "Database" as DB
end box

== Institute/Location Selection ==

User -> FilterBar: 29. Select institute: "University of Tunis"
activate FilterBar

FilterBar -> InstituteService: 30. Get institute coordinates
activate InstituteService
InstituteService --> FilterBar: 31. Institute data with lat/lng
deactivate InstituteService

FilterBar -> Frontend: 32. Emit instituteSelected event
activate Frontend

Frontend -> Controller: 33. GET /api/properties/search?instituteId=123&radiusKm=3.0
activate Controller

Controller -> Service: 34. searchProperties(criteria with geospatial)
activate Service

Service -> DB: 35. Geospatial query within radius
activate DB
DB --> Service: 36. Properties near institute
deactivate DB

Service --> Controller: 37. Location-based results
deactivate Service

Controller --> Frontend: 38. 200 OK - Nearby properties
deactivate Controller

Frontend -> MapComponent: 39. Update map with institute pin and nearby properties
activate MapComponent

MapComponent -> MapComponent: 40. Add institute marker
MapComponent -> MapComponent: 41. Add property pins within radius
MapComponent -> MapComponent: 42. Center map on institute location

MapComponent --> User: 43. Map centered on institute with nearby properties
deactivate MapComponent

deactivate FilterBar
deactivate Frontend

@enduml 